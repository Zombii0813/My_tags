# 使用指南（初步版本）

本指南适用于当前初步版本，覆盖工作空间扫描、标签管理与筛选等基础流程。

## 1. 运行环境

- Windows 10/11
- Python 3.10+

## 2. 安装与启动

### 2.1 使用 requirements.txt

1. 创建虚拟环境
2. 安装依赖：

```bash
pip install -r requirements.txt
```

3. 启动：

```bash
python -m app
```

## 3. 环境变量（必须）

设置工作空间目录（必填）：

- `MYTAGS_WORKSPACE`：工作空间根目录路径

也可以通过 `.env` 文件设置，参考 `.env.example`。

可选配置：

- `MYTAGS_DATA_DIR`：应用数据目录（默认 `~/.mytags`）
- `MYTAGS_DB_PATH`：SQLite 数据库文件路径
- `MYTAGS_THUMBS_DIR`：缩略图目录

示例（PowerShell）：

```powershell
$env:MYTAGS_WORKSPACE = "D:\\MyWorkspace"
```

## 4. 基本操作

### 4.1 扫描工作空间

- 点击工具栏 `Scan`
- 首次扫描会建立索引，完成后在中间区域显示文件列表
- 默认不计算文件哈希以提升速度
- 扫描过程中会分批提交以提升速度与稳定性

### 4.2 选择工作空间

- 点击工具栏 `Workspace`
- 选择目录后会作为本次会话的工作空间

### 4.3 创建与删除标签

- 左侧标签面板点击 `Add` 创建标签
- 选中标签后点击 `Delete` 删除标签（相关绑定会一并清理）

### 4.4 绑定与移除标签

- 在中间文件列表中选中一个或多个文件
- 在左侧标签面板中选中一个或多个标签
- 点击 `Apply`：替换选中文件的标签为当前选择的标签集合
- 点击 `Remove`：从选中文件上移除当前选择的标签

### 4.5 删除索引记录

- 在文件列表中选中一个或多个文件
- 点击工具栏 `Delete`
- 仅删除索引与标签绑定记录，不会删除磁盘上的实际文件

### 4.6 标签筛选

- 在左侧选中多个标签
- 点击 `Filter`：按标签交集过滤文件列表
- 点击 `Clear`：清除筛选并回到全部文件

- 勾选 `Match All`：标签交集（默认）
- 取消勾选：标签并集

### 4.6.1 类型与排序

- 顶部下拉可按类型筛选（图片/视频/文档/音频/其他）
- 排序支持名称正序/倒序、修改时间、大小

### 4.6.2 视图与层级

- 视图切换支持列表与缩略图网格
- 层级切换支持全部平铺与按文件夹折叠/展开

### 4.7 搜索

- 在顶部输入框输入关键字
- 按 Enter 执行搜索，当前版本仅支持文件名模糊搜索

### 4.8 查看详情

- 选中文件后，右侧详情面板显示路径、大小、类型与标签信息
- 若多选，会显示当前选中数量

### 4.9 移动与复制文件

- 选中文件后点击 `Move` 或 `Copy`
- 选择目标目录后执行
- 当前版本对重名文件会自动追加 `_<id>` 后缀

### 4.10 打开文件与文件夹

- 选中单个文件后点击 `Open File` 或 `Open Folder`

### 4.11 图片预览

- 仅支持图片文件的预览
- 在右侧详情面板中显示缩略预览

### 4.13 视频缩略图

- 缩略图生成依赖 `ffmpeg`（需自行安装）
- 如未识别到 ffmpeg，可设置 `MYTAGS_FFMPEG` 或 `FFMPEG_PATH`
- 网格视图下会显示视频缩略图

### 4.12 文件监听

- 扫描完成后自动开启监听
- 文件新增/修改会更新索引
- 文件删除会从索引中移除

## 5. 当前版本范围

- 工作空间扫描与基础索引
- 标签增删、文件标签绑定与移除
- 标签筛选（交集）
- 文件名搜索
- 文件详情查看
- 文件打开与文件夹打开
- 文件移动与复制
- 图片预览（仅图片类型）
- 文件监听与增量更新
- 视频缩略图（需 ffmpeg）

## 6. 注意事项

- 首次扫描会耗时，文件较多时请耐心等待
- 当前版本仅支持图片预览，未实现视频与文档缩略图
- 数据库存放位置由 `MYTAGS_DATA_DIR` 或 `MYTAGS_DB_PATH` 控制
- 如需更高准确性可在后续版本开启哈希计算
